# 数据库与身份认证

## 1. 数据库的基本概念

### 1.1 什么是数据库

数据库(database)是用来组织、存储和管理数据的仓库。

当今世界是一个充满着数据的互联网世界，充斥着大量的数据。数据的来源有很多，除了文本类型的数据，图像、音乐、声音都是数据。

为了方便管理互联网世界中的数据，就有了数据库管理系统的概念(简称：数据库)。用户可以对数据库中的数据进行**新增、查询、更新、删除**等操作。

### 1.2 常见的数据库及分类

市面上的数据库有很多种，最常见的数据库有如下几个：

- MySQL数据库(目前使用最广泛，流行度最高的开源免费数据库；Community+Enterprise)
- Oracle数据库(收费)
- SQL Server数据库(收费)
- MongoDB数据库(Community+Enterprise)

其中，MySQL、Oracle、SQL Server属于**传统型数据库**(又叫做：**关系型数据库**或**SQL数据库**)，这三者的设计理念相同，用法比较相似。

而MongoDB属于**新型数据库**(又叫做：**非关系型数据库**或**NoSQL数据库**)，它在一定程度上弥补了传统型数据库的缺陷。

### 1.3 传统型数据库的数据组织结构

数据的组织结构：指的就是数据以什么样的结构进行存储。

传统型数据库的数据组织结构和Excel中数据的组织结构比较类似。

1. Excel的数据组织结构

   每个Excel中，数据的组织结构分别为工作簿、工作表、数据行、列这四大部分组成。

   ![image-20230104113926241](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20230104113926241.png)

2. 传统型数据库的数据组织结构

   在传统型数据库中，数据的组织结构分为数据库(database)、数据表(table)、数据行(row)、字段(field)。

   ![image-20230104114110275](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20230104114110275.png)

3. 实际开发中库、表、行、字段之间的关系
   - 在实际项目开发中，一般情况下，每个项目都对应独立的数据库。
   - 不同的数据，要存储到数据库的不同表中。
   - 每个表中具体要存储哪些信息由字段来决定。
   - 表中的行，代表着每一条具体的数据。

## 2. 安装并配置MySQL

### 2.1 了解需要安装哪些MySQL相关的软件

对于开发人员来说，需要安装MySQL Server和MySQL Workbench这两个软件。

- MySQL Server：专门用来提供数据存储和服务的软件。
- MySQL Workbench：可视化的MySQL管理工具，通过它可以很方便的操作存储在MySQL Server中的数据。

ps：由于我之前已经装了这两个东西而且已经进行过相应的使用了，这边就不写怎么具体安装了，反正网上教程一查一大把。

## 3. 在项目中操作MySQL

### 3.1 在项目中操作数据库的步骤

1. 安装操作MySQL数据库的第三方模块mysql
2. 通过mysql模块连接到MySQL数据库
3. 通过mysql模块执行SQL语句

![image-20230104135603279](C:\Users\ASUS\AppData\Roaming\Typora\typora-user-images\image-20230104135603279.png)

### 3.2 安装与配置mysql模块

1. 安装mysql模块

   mysql是托管于npm上的第三方模块。它提供了在Node.js项目中链接和操作MySQL数据库的能力。

   想要在项目中使用它，需要先运行如下命令将mysql安装为项目的依赖包：

   ```js
   npm install mysql
   ```

2. 配置mysql模块

   在使用mysql模块操作MySQL数据库之前，必须先对mysql模块进行必要的配置，主要的配置步骤如下：

   ```js
   // 1.导入mysql模块
   const mysql = require('mysql')
   // 2.建立与MySQL数据库的链接关系
   const db = mysql.createPool({
     host: '127.0.0.1', // 数据库的ip地址
     user: 'root', // 登录数据库的账号
     password: '20021209xiang', // 登录数据库的密码
     database: 'my_db_01' // 指定要操作哪个数据库
   })
   ```

3. 测试mysql模块能否正常工作

   调用db.query()函数，指定要执行的SQL语句，通过回调函数拿到执行的结果：

   ```js
   // 测试mysql模块能否正常工作
   db.query('select 1', (err, results) => {
     // mysql模块工作期间报错了
     if (err) return console.log(err.message)
     // 能够正常的执行SQL语句
     console.log(results)
   })
   ```

### 3.3 使用mysql模块操作MySQL数据库

1. 查询数据

   查询users表中所有的数据(之前已经把这个表建好了，用MySQL Workbench)

   ```js
   // 查询users表中所有的数据
   const sqlStr = 'select * from users' // 定义要查询的sql语句
   db.query(sqlStr, (err, results) => {
     // 查询数据失败
     if (err) return console.log(err.message)
     // 查询数据成功
     // 注意：如果执行的是select这个查询语句，则执行的结果是一个对象的数组！
     console.log(results)
   })
   ```

2. 插入数据

   向users表中新增数据，其中username=Spider-Man，password为pcc321。示例代码如下：

   ```js
   // 向users表中新增一条数据
   const user = { username: "Spider-Man", password: "pcc123" }
   // 定义待执行的SQL语句
   // 注意：此处的?为占位符，用来被预填充，把数据对象的值依次丢进来
   const sqlStr = 'insert into users (username,password) values(?,?)'
   // 执行SQL语句
   db.query(sqlStr, [user.username, user.password], (err, results) => {
     // 失败
     if (err) return console.log(err.message)
     // 成功
     if (results.affectedRows === 1) {
       // 注意：如果执行的是insert into插入语句，则results为一个对象
       // 可以通过affectedRows来判断插入是否成功
       console.log("插入数据成功！")
     }
   })
   ```

3. 插入数据的便捷方式

   向表中新增数据时，**如果数据对象的每个属性和数据表的字段都一一对应**，则可以通过如下方式快速插入数据：

   ```js
   // 演示插入数据的便捷方式(仅限于数据对象的每个属性和数据表的字段都一一对应的情况)
   const user = { username: "Spider-Man2", password: "pcc4321" }
   // 定义待执行的SQL语句
   const sqlStr = 'insert into users set ?'
   // 执行SQL语句
   db.query(sqlStr, user, (err, results) => {
     // 失败
     if (err) return console.log(err.message)
     // 成功
     if (results.affectedRows === 1) {
       console.log("插入数据成功！")
     }
   })
   ```

4. 更新数据

   可以通过如下方式，更新表中的数据：

   ```js
   // 演示如何更新用户的信息
   const user = { id: 5, username: "bubuji", password: "000" }
   // 定义SQL语句
   const sqlStr = 'update users set username=?,password=? where id=?'
   // 执行SQL语句
   db.query(sqlStr, [user.username, user.password, user.id], (err, results) => {
     if (err) return console.log(err.message)
     // 注意：执行了update语句之后的results结果也是一个对象，用affectedRows判断更新是否成功
     if (results.affectedRows === 1) {
       console.log("更新成功")
     }
   })
   ```

5. 更新数据的便捷方式

   更新表数据时，**如果数据对象的每个属性和数据表的字段一一对应**，可以通过如下方式快速更新表数据：

   ```js
   // 演示如何快速更新用户的信息(原理和上面的便捷插入一样)
   const user = { id: 5, username: "bubuji", password: "000" }
   // 定义SQL语句
   const sqlStr = 'update users set ? where id=?'
   // 执行SQL语句
   db.query(sqlStr, [user, user.id], (err, results) => {
     if (err) re urn console.log(err.message)
     // 注意：执行了update语句之后的results结果也是一个对象，用affectedRows判断更新是否成功
     if (results.affectedRows === 1) {
       console.log("更新数据成功")
     }
   })
   ```

6. 删除数据

   在删除数据时，推荐根据id这样的唯一标识来删除数据。示例如下：

   ```js
   // 删除id为4的用户
   const sqlStr = 'delete from users where id=?'
   db.query(sqlStr, 4, (err, results) => {
     if (err) return console.log(err.message)
     // 注意：执行了delete语句之后的results结果也是一个对象，用affectedRows判断更新是否成功
     if (results.affectedRows === 1) {
       console.log("删除数据成功")
     }
   })
   ```

7. 标记删除

   使用delete语句，会真正的把数据从表中删除掉。**为了避免误删，采用标记删除的形式来模拟删除的动作**。

   所谓的标记删除，就是在表中设置类似于status这样的字段，来**标记**这条数据是否被删除。

   当用户执行了删除的动作时，我们并没有执行delete这样的语句删数据，而执行的是update语句将其status标记为删除。

   ```js
   // 标记删除id为4的用户
   const sqlStr = 'update users set status=? where id=?'
   db.query(sqlStr, [1, 3], (err, results) => {
     if (err) return console.log(err.message)
     // 注意：执行了delete语句之后的results结果也是一个对象，用affectedRows判断更新是否成功
     if (results.affectedRows === 1) {
       console.log("删除数据成功")
     }
   })
   ```

   
